## 接入流程
此接入流程仅适用于API接口的调用链接。

1.  **申请账号**
    请您访问123开放平台官网，阅读开发者协议，填写对应必填项 `*` 信息，申请 `client_id` 和 `client_secret`。申请通过后会自动发送到您填入的邮箱地址，请您妥善保存。

2.  **获取访问凭证**
    访问凭证（也称为 `access_token`）。调用 API 时，需要在 HTTP Header 中携带访问凭证。有关访问凭证的介绍详见 [获取access_token](#获取access_token)。

3.  **调用 API**
    完成上述步骤后，就可以调用 API 了。

## 开发须知

### 注意事项
- 调用服务端接口时，需使用 HTTPS 协议、JSON 数据格式、UTF-8 编码，POST 请求请在 HTTP Header 中设置 `Content-Type: application/json`。
- 接口域名为： `https://open-api.123pan.com`
- 分配的 `client_secret` 请注意安全保存，不要放在前端代码里，泄露后请联系客服更换。
- 所有请求接口均需要带上请求头 `platform` 值为: `open_platform`。
- 开放平台发放的 Access Token 也将作为设备计算。同一时刻只允许 `client_id` 下最多 3 个token 正在使用。多次颁发会存在将 Token 踢下线的情况。颁发后的 Token 有效期为 30 天。

### 公共请求头

| 请求头名称 | 是否必填 | 类型 | 示例值 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| `Authorization` | 是 | string | `Bearer access_token` | 注意格式： `Bearer`+`空格`+`access_token` |
| `Platform` | 是 | string | `open_platform` | 固定值：`open_platform` |
| `Content-Type` | 是 | string | `application/json` | 固定值：`application/json` |

**接口身份校验示例**
```
Authorization: Bearer your_access_token_here
```

### 接口响应参数

| 参数名称 | 是否必填 | 类型 | 示例值 | 描述 |
| :--- | :--- | :--- | :--- | :--- |
| `code` | 是 | int | `0` | `code`字段等于`0` 标识成功响应，其他code为失败响应 |
| `message` | 是 | string | `ok` | 请求成功为`ok`；异常时为具体异常信息 |
| `data` | 是 | any | - | 返回的响应内容；异常时为`null` |
| `x-traceID` | 是 | string | `eyJhbG...` | 接口响应异常需要技术支持请提供接口返回的`x-traceID` |

**接口响应示例**

所有 API 的响应体中都包含`code`、`message`、`data`字段，`data`字段的数据结构请查看具体接口的文档。API都使用返回的 `code`字段等于`0` 标识成功响应，其他code为失败响应，请根据响应的code和message排查错误具体原因。如果接口响应异常需要技术支持请提供接口返回的`x-traceID`。

```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "some_key": "some_value"
  },
  "x-traceID": "16f60c4d-f022-42d3-b3df-85d1fe2a3ac5_kong-db-5898fdd8c6-wgsts"
}
```

### 常用code码

| body 中的 code | 描述 |
| :--- | :--- |
| `401` | access_token无效 |
| `429` | 请求太频繁 |

---

## 限流处理
为确保所有用户的使用体验，123云盘开放平台会对下面 API 进行限流：

| API | 限制QPS（同一个client_id，每秒最大请求次数） |
| :--- | :--- |
| `api/v1/user/info` | 1 |
| `api/v1/file/move` | 1 |
| `api/v1/file/delete` | 1 |
| `api/v1/file/list` | 4 |
| `api/v2/file/list` | 3 |
| `upload/v1/file/mkdir` | 2 |
| `upload/v1/file/create` | 2 |
| `api/v1/access_token` | 1 |
| `api/v1/share/list` | 10 |
| `api/v1/share/list/info` | 10 |
| `api/v1/transcode/folder/info` | 20 |
| `api/v1/transcode/upload/from_cloud_disk` | 1 |
| `api/v1/transcode/delete` | 10 |
| `api/v1/transcode/video/resolutions` | 1 |
| `api/v1/transcode/video` | 3 |
| `api/v1/transcode/video/record` | 20 |
| `api/v1/transcode/video/result` | 20 |
| `api/v1/transcode/file/download` | 10 |
| `api/v1/transcode/m3u8_ts/download` | 20 |
| `api/v1/transcode/file/download/all` | 1 |

---

## 获取access_token
**API:** `POST https://open-api.123pan.com/api/v1/access_token`

**注：** 此接口有访问频率限制。请获取到access_token后本地保存使用，并在access_token过期前及时重新获取。access_token有效期根据返回的`expiredAt`字段判断。

### Header 参数
| 名称 | 类型 | 是否必填 | 说明 |
| :--- | :--- | :--- | :--- |
| `Platform` | string | 是 | `open_platform` |

### Body 参数
| 名称 | 类型 | 是否必填 | 说明 |
| :--- | :--- | :--- | :--- |
| `clientID` | string | 必填 | - |
| `clientSecret` | string | 必填 | - |

### 返回数据
| 名称 | 类型 | 是否必填 | 说明 |
| :--- | :--- | :--- | :--- |
| `accessToken` | string | 必填 | 访问凭证 |
| `expiredAt` | string | 必填 | access_token过期时间 |

### 示例

#### 请求示例

**NodeJs - Axios**
```javascript
const axios = require('axios');
let data = JSON.stringify({
  "clientID": "123456789",
  "clientSecret": "123456789"
});

let config = {
  method: 'post',
  maxBodyLength: Infinity,
  url: 'https://open-api.123pan.com/api/v1/access_token',
  headers: { 
    'Platform': 'open_platform', 
    'Content-Type': 'application/json'
  },
  data : data
};

axios.request(config)
  .then((response) => {
    console.log(JSON.stringify(response.data));
  })
  .catch((error) => {
    console.log(error);
  });
```

**Python - http.client**
```python
import http.client
import json

conn = http.client.HTTPSConnection("open-api.123pan.com")
payload = json.dumps({
    "clientID": "123456789",
    "clientSecret": "123456789"
})
headers = {
    'Platform': 'open_platform',
    'Content-Type': 'application/json'
}
conn.request("POST", "/api/v1/access_token", payload, headers)
res = conn.getresponse()
data = res.read()
print(data.decode("utf-8"))
```

#### 响应示例

```json
{
  "code": 0,
  "message": "ok",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyxxxxx...(过长已省略)",
    "expiredAt": "2025-03-23T15:48:37+08:00"
  },
  "x-traceID": "16f60c4d-f022-42d3-b3df-85d1fe2a3ac5_kong-db-5898fdd8c6-wgsts"
}
```
```
